<!--DfHateoas.HandleError-->
<!--DfHateoas.HandleResponse-->
<!--DfHateoas.HandleError-->

<script>
  var DfHateoas = DfHateoas || {};

  DfHateoas.DecodeUrl = {
    properties: {
      encodedUrl: {
        type: String,
        notify: true
      },
      usableUrl: {
        type: Object,
        notify: true
      }
    },
    encodeUrl: function (base, url) {
      var target = url;
      var newchar = '_';
      target = target.split('/').join(newchar);
      return base + encodeURIComponent(target);
    },
    decodeUrl: function (incomingUrl) {
      if (incomingUrl) {
        this.encodedUrl = incomingUrl;
        var target = incomingUrl;
        var newchar = '/';
        target = target.split('_').join(newchar);
        target = decodeURIComponent(target);
        if (target && target.startsWith("http")) {
          this.usableUrl = target;
        } else {
          this.usableUrl = 'http://' + target;
        }
      }
    }
  }

  DfHateoas.HandleResponse = {
    properties: {
      jsonObject: {
        type: Object,
        notify: true
      },
      jsonString: {
        type: String,
        notify: true
      },
      viewType: {
        type: String,
        notify: true,
        readOnly: true
      }
    },

    _handleResponse: function (data) {
      this.jsonObject = null;
      this.jsonString = null;
      if (data.detail.response) {
        this.jsonObject = data.detail.response;
        this.jsonString = JSON.stringify(this.jsonObject, null, 2);
        this.viewType = this._computeViewType;
      } else {
        console.log("RESPONSE HAD NO MEANINGFUL DATA");
      }
    },

    _computeViewType: function () {
      this.viewType = "other";
      var keys = this._keys(this.jsonObject);
      var hasLinks = this._contains("_links", keys);
      var hasSearch = this._hasLinksSearch();
      var hasEmbedded = this._contains("_embedded", keys);
      var hasPage = this._contains("page", keys);
      var hasNext = this._hasLinksNext();
      var hasPrev = this._hasLinksPrev();
      var hasLinksProfile = this._hasLinksProfile();
      if (hasLinks && hasLinksProfile && keys.length == 1) {
        this.viewType = "rootView"
      }
      if (hasLinks && hasSearch && hasEmbedded && hasPage && hasNext && hasPrev) {
        return "middleItems";
      }
      if (hasLinks && hasSearch && hasEmbedded && hasPage && hasNext) {
        this.viewType = "beginItems";
      }
      if (hasLinks && hasSearch && hasEmbedded && hasPage && hasPrev) {
        this.viewType = "endItems";
      }
      if (hasLinks && !hasSearch && !hasEmbedded && !hasPage && !hasLinksProfile && keys.length > 1) {
        this.viewType = "itemView";
      }
      if (hasLinks && keys.length == 1) {
        this.viewType = "searchView";
      }
    }
    ,

    _keys: function (obj) {
      var keys = [];
      if (obj === undefined || obj == null) {
        return null;
      }
      for (var key in obj) {
        var attrName = key;
        keys.push(key);
      }
      return keys;
    }
    ,

    _hasLinksProfile: function () {
      if (this.jsonObject === undefined || this.jsonObject == null) {
        return false;
      }
      if (this.jsonObject._links != null
        && this.jsonObject._links.profile != undefined
        && this.jsonObject._links.profile.href != undefined) {
        return true;
      }
      return false;
    }
    ,

    _hasLinksSelf: function () {
      if (this.jsonObject === undefined || this.jsonObject == null) {
        return false;
      }
      if (this.jsonObject._links != null
        && this.jsonObject._links.self != undefined
        && this.jsonObject._links.self.href != undefined) {
        return true;
      }
      return false;
    }
    ,

    _hasLinksNext: function () {
      if (this.jsonObject === undefined || this.jsonObject == null) {
        return false;
      }
      if (this.jsonObject._links != null
        && this.jsonObject._links.next != undefined
        && this.jsonObject._links.next.href != undefined) {
        return true;
      }
      return false;
    }
    ,

    _hasLinksPrev: function () {
      if (this.jsonObject === undefined || this.jsonObject == null) {
        return false;
      }
      if (this.jsonObject._links != null
        && this.jsonObject._links.prev != undefined
        && this.jsonObject._links.prev.href != undefined) {
        return true;
      }
      return false;
    }
    ,

    _hasLinksSearch: function () {
      if (this.jsonObject === undefined || this.jsonObject == null) {
        return false;
      }
      if (this.jsonObject._links != null
        && this.jsonObject._links.search != undefined
        && this.jsonObject._links.search.href != undefined) {
        return true;
      }
      return false;
    }
    ,

    _contains: function (obj, arr) {
      if (obj === undefined || obj === null || arr === undefined || arr == null) {
        return false;
      }
      var i = arr.length;
      while (i--) {
        if (arr[i] === obj) {
          return true;
        }
      }
      return false;
    }

  }

  DfHateoas.HandleError = {
    properties: {
      errorString: {
        type: String,
        notify: true
      }
    },
    _handleError: function (data) {
      this.errorString = data;
    }
  }

</script>
